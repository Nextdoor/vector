---
date: "2022-06-16"
title: "0.23 Upgrade Guide"
description: "An upgrade guide that addresses breaking changes in 0.23.0"
authors: ["akx", "jszwedko", "spencergilbert", "fuchsnj", "pablosichert"]
release: "0.23.0"
hide_on_release_notes: false
badges:
  type: breaking change
---

Vector's 0.23.0 release includes **breaking changes**:

1. [The `.deb` package no longer enables and starts the Vector systemd service](#systemd-autostart)
2. [`kubernetes_logs` source now requires rights to list and watch nodes](#kubernetes-logs-list-watch-nodes)
2. [VRL type definition updates](#vrl-type-def)
3. ["remove_empty" option dropped from VRL's `parse_grok` and `parse_groks`](#vrl-parse_grok)
4. [`gcp_pubsub` sink requires setting "encoding" option](#gcp_sink-mandatory-encoding)
5. [`humio_metrics` sink no longer has "encoding" option](#humio_metrics-sink-fixed-encoding)
6. [VRL conditions are now checked for mutations at compile time](#read_only_check)
7. [Support for older OSes dropped](#old-oses)

We cover them below to help you upgrade quickly:

## Upgrade guide

### Breaking changes

#### The `.deb` package no longer enables and starts the Vector systemd service {#systemd-autostart}

The [official `.deb` package](https://vector.dev/download/)
no longer automatically enables and starts the Vector systemd service.
This is in line with how the RPM package behaves.

To enable and start the service (after configuring it to your requirements),
you can use `systemctl enable --now`:

```shell
systemctl enable --now vector
```

To just start the service without enabling it to run at system startup,

```shell
systemctl start vector
```

#### `kubernetes_logs` source now requires rights to list and watch nodes {#kubernetes-logs-list-watch-nodes}

Logs from Kubernetes pods are now annotated with a node's labels on which a pod is running.

1. For official helm-chart users, upgrade the chart to the version >= [0.11.0](https://github.com/vectordotdev/helm-charts/releases/tag/vector-0.11.0)
   before upgrading the vector version in your cluster.
2. For custom vector installations, modify the cluster role assigned to the vector service account to include nodes.
   The result should look like the following snippet:

```yaml
# Permissions to use Kubernetes API.
# Requires that RBAC authorization is enabled.
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: vector
rules:
  - apiGroups:
      - ""
    resources:
      - namespaces
      - nodes
      - pods
    verbs:
      - list
      - watch
```

#### [VRL type definition updates] {#vrl-type-def}

There were many situations where VRL didn't calculate the correct type
definition. These are now fixed. In some cases this can cause compilation
errors when upgrading if the code relied on the previous behavior.

This affects the following:

- the "merge" operator (`|` or `|=`) on objects that share keys with different types
- if statements
- nullability checking for most expressions (usually related to if statements)
- expressions that contain the `abort` expression
- the `del` function
- closure arguments

#### ["remove_empty" option dropped from VRL's `parse_grok` and `parse_groks`] {#vrl-parse_grok}

The "remove_empty" argument has been dropped from both the `parse_grok` and the
`parse_groks` functions. Previously, these functions would return empty strings
for non-matching pattern names, but now they are not returned. To preserve the
old behavior, you can do something like the following to merge in empty strings
for each unmatched group:

```coffee
parsed = parse_grok!(.message, "%{TIMESTAMP_ISO8601:timestamp} %{LOGLEVEL:level} %{GREEDYDATA:message}")
expected = { "timestamp": "", "level": "", "message": ""}
parsed = merge(expected, parsed)
```

#### [`gcp_pubsub` sink requires setting "encoding" option] {#gcp_sink-mandatory-encoding}

The `gcp_pubsub` sink now supports a variety of codecs. To encode your logs as JSON before
publishing them to Cloud Pub/Sub, add the following encoding option

```toml
encoding.codec = "json"
```

to the config of your `gcp_pubsub` sink.

#### [`humio_metrics` sink no longer has "encoding" option] {#humio_metrics-sink-fixed-encoding}

The `humio_metrics` sink configuration no longer expects an "encoding" option.
If you previously used the encoding option

```toml
encoding.codec = "json"
```

you need to remove the line from your `humio_metrics` config. Metrics are now
always sent to Humio using the JSON format.

#### [VRL conditions are now checked for mutations at compile time] {#read_only_check}

VRL conditions, for example those used in the `filter` transform, are not supposed to mutate the event. Previously
the mutations would be silently ignored after a condition ran. Now the compiler has support for read-only values, and
will give a compile-time error if you try to mutate the event in a condition.

Example filter transform config

```toml
[transforms.filter]
type = "filter"
inputs = [ "input" ]
condition.type = "vrl"
condition.source = """
.foo = "bar"
true
"""
```

New error

```text
error[E315]: mutation of read-only value
  ┌─ :1:1
  │
1 │ .foo = "bar"
  │ ^^^^^^ mutation of read-only value
  │
  = see language documentation at https://vrl.dev
```

#### [Support for older OSes dropped](#old-oses)

Due to changes to the [tool we use for cross-compiling Vector](https://github.com/cross-rs/cross), support for operating
systems with old versions of `libstdc++` were dropped for the `x86-uknown_linux-gnu` target. Vector now requires that
the host system has `libstdc++` >= 3.4.21 with support for ABI version 1.3.8.

Known OSes that this affects:

- Amazon Linux 1
- Ubuntu 14.04

We will be looking at options to re-add support for these OSes in the future.
